<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      * {
        font-family: sans-serif;
      }
      body {
        font-size: 14px;
      }
      h3,
      p,
      ul {
        margin: 0;
      }
      section {
        margin: 20px 0;
        padding: 5px;
        box-shadow: 0 0 9px #d48dd4;
        border-radius: 3px;
      }
      section > div {
        margin: 5px 0;
      }
      .query {
        background-color: #dbdccf;
        padding: 7px 5px;
      }
      .query pre {
        margin: 0;
      }
      table {
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #723457;
        padding: 2px;
      }
      sup {
        color: #454545;
      }
      th[colspan] {
        color: #723457;
      }
      .source-table {
        display: flex;
      }
      .source-table table {
        margin-right: 7px;
      }
    </style>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Postgresql</title>
  </head>
  <body>
    <section>
      <div class="title">
        <h3>Create new table</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            This query will create new table called people in our database.
          </li>
          <li>
            Serial is similar to integer, but starting from positive value.
          </li>
          <li>
            With Default we can specify default value if it is not provided,
            when creating a record.
          </li>
          <li>
            With Check for we can add validation for required value before
            insert. As you can see below we can add check for specific column or
            between columns.
          </li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>CREATE TABLE</b> people (
  id <b>SERIAL PRIMARY KEY</b>,
  name <b>VARCHAR</b>(20) NOT NULL,
  city <b>VARCHAR</b>(20) <b>DEFAULT</b> 'Sofia',
  monthly_income <b>DECIMAL</b> <b>CHECK</b> (monthly_income > 0),
  travel_spendings <b>DECIMAL</b>,
  <b>CHECK</b> (monthly_income &gt; travel_spendings)
);</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Create new table with foreign key</h3>
      </div>
      <div class="info">
        <ul>
          <li>This query will create new table using foreign key.</li>
          <li>
            With cascade delete if in table people user with the same id as the
            foreign key is deleted, the record in this table will be also
            deleted.
          </li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>CREATE TABLE</b> pets (
  id <b>SERIAL PRIMARY KEY</b>,
  pet <b>VARCHAR</b>(20),
  person_id <b>INTEGER REFERENCES</b> people(id) <b>ON DELETE CASCADE</b>
);</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>pet</th>
              <th>person_id<sup>FK</sup></th>
            </tr>
          </thead>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Create new table with multi column null check</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Coalesce will return the first not null value, if all values are
            null it will return null
          </li>
          <li>
            So in this case we require at least email or phone to be provided.
          </li>
          <li>
            For the second check we will cast the id to boolean and then the
            boolean to integer, so we will end up with 0 or 1 for each coalesce.
          </li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>CREATE TABLE</b> contact (
  id <b>SERIAL PRIMARY KEY</b>,
  email <b>VARCHAR</b>(20),
  phone <b>VARCHAR</b>(20),
  contact_book_id <b>INTEGER REFERENCES</b> contact_book(id) <b>ON DELETE CASCADE</b>,
  private_book_id <b>INTEGER REFERENCES</b> private_book(id) <b>ON DELETE CASCADE</b>,
  <b>CHECK</b> (<b>COALESCE</b>(email, phone) <b>IS NOT NULL</b>),
  <b>CHECK</b> (
    <b>COALESCE</b>((contact_book_id)<b>::BOOLEAN::INTEGER</b>, 0)
    +
    <b>COALESCE</b>((private_book_id)<b>::BOOLEAN::INTEGER</b>, 0)
    = 1
  )
);</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>email</th>
              <th>phone</th>
              <th>contact_book_id<sup>FK</sup></th>
              <th>private_book_id<sup>FK</sup></th>
            </tr>
          </thead>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Delete table</h3>
      </div>
      <div class="info">
        <ul>
          <li>This query will delete specific table.</li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>DROP TABLE</b> people;
</pre>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Create index</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Index is useful for search optimizations, especially, when operating
            on the entire tables
          </li>
          <li>
            But there is also downsides. It increase the size of the disk space
            we need. And is slowing operations like insert, update and delete.
          </li>
          <li>
            The convention for naming indexes is first that table name, column
            name, idx
          </li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>CREATE TABLE</b> users ( 
  id <b>SERIAL PRIMARY KEY</b>,
  name <b>VARCHAR</b>(20)
);

<b>CREATE INDEX</b> users_name_idx <b>ON</b> users(name);
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Modify column of existing table</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            We can modify the columns settings of already exisiting tables.
          </li>
          <li>Similarly we can add Unique or Check constraints.</li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>ALTER TABLE</b> people 
<b>ALTER COLUMN</b> name <b>SET NOT NULL</b>;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Insert data into a table</h3>
      </div>
      <div class="info">
        <ul>
          <li>Note that values are in single quotes.</li>
          <li>Provided values order should match the expected values.</li>
          <li>Here we assume, that Primary key was set.</li>
        </ul>
      </div>
      <div class="query">
        <pre>
<b>INSERT INTO</b> people(name, city, monthly_income, travel_spendings)
<b>VALUES</b> ('Mira', 'Sofia', 5800, 2200.50), ('Iva', 'Plovdiv', 7200, 1900);
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200.50</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Read data</h3>
      </div>
      <div class="info">
        <ul>
          <li>This way we will read all the table's data.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200.50</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> * <b>FROM</b> people;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200.50</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Read partial data</h3>
      </div>
      <div class="info">
        <ul>
          <li>This way we will read only specific columns.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200.50</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name, city <b>FROM</b> people;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Read and transform data</h3>
      </div>
      <div class="info">
        <ul>
          <li>We can use math operators with different columns values.</li>
          <li>With AS we can get meaningful column names.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name, monthly_income - travel_spendings <b>AS</b> net, travel_spendings / monthly_income * 100 <b>AS</b> perc
<b>FROM</b> people;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>net</th>
              <th>perc</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>3599.50</td>
              <td>37.93965517241379310300</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>5300</td>
              <td>26.38888888888888888900</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sum values</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Sum is aggregate function which will combine all rows in a sum.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>3500</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>3700</td>
            </tr>
            <tr>
              <td>Mitko</td>
              <td>3900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> <b>sum</b>(income) <b>AS</b> total <b>FROM</b> people;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>11100</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Use functions</h3>
      </div>
      <div class="info">
        <ul>
          <li>We can use functions to transform the output.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT CONCAT</b> (name, ' lives in ', UPPER(city), '.') <b>AS</b> sentence
<b>FROM</b> people;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>sentence</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira lives in SOFIA.</td>
            </tr>
            <tr>
              <td>Iva lives in PLOVDIV.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Filter results</h3>
      </div>
      <div class="info">
        <ul>
          <li>This is how we can filter results.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name, city <b>FROM</b> people
<b>WHERE</b> monthly_income >= 7000 <b>AND</b> city = 'Plovdiv';
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Between value or in array of values</h3>
      </div>
      <div class="info">
        <ul>
          <li>This is how we can filter results.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name, city <b>FROM</b> people
<b>WHERE</b> monthly_income <b>BETWEEN</b> 5000 <b>AND</b> 7000 <b>AND</b> city <b>IN</b> ('Sofia', 'Varna');
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Update value</h3>
      </div>
      <div class="info">
        <ul>
          <li>We can update all values or some, based on condition.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>UPDATE</b> people <b>SET</b> monthly_income = 6900 <b>WHERE</b> name = 'Mira' <b>OR</b> city = 'Sofia';
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>6900</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Delete row/rows</h3>
      </div>
      <div class="info">
        <ul>
          <li>We can delete all rows or some, based on condition.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5800</td>
              <td>2200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>DELETE FROM</b> people <b>WHERE</b> name = 'Mira';
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>monthly_income</th>
              <th>travel_spendings</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>7200</td>
              <td>1900</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Joining tables - Inner Join</h3>
      </div>
      <div class="info">
        <ul>
          <li>Inner join will return result which are match in both tables.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th colspan="2">users</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Ivan</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Metodi</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Marina</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">images</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>url</th>
              <th>user_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>image-1.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>image-2.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>3</td>
              <td>image-3.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>image-4.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>5</td>
              <td>image-5.png</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> u.id <b>AS</b> uid, name, i.id <b>AS</b> iid, url, user_id
<b>FROM</b> users <b>AS</b> u <b>INNER JOIN</b> images <b>AS</b> i <b>ON</b> u.id = i.user_id;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>uid</th>
              <th>name</th>
              <th>iid</th>
              <th>url</th>
              <th>user_id</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
              <td>1</td>
              <td>image-1.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>1</td>
              <td>Mira</td>
              <td>2</td>
              <td>image-2.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
              <td>3</td>
              <td>image-3.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
              <td>4</td>
              <td>image-4.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Ivan</td>
              <td>5</td>
              <td>image-5.png</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Joining tables - Left Join</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Left join will get all the records from the table on the left.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th colspan="2">users</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Ivan</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Metodi</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Marina</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">images</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>url</th>
              <th>user_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>image-1.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>image-2.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>3</td>
              <td>image-3.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>image-4.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>5</td>
              <td>image-5.png</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> u.id <b>AS</b> uid, name, i.id <b>AS</b> iid, url, user_id
<b>FROM</b> users <b>AS</b> u <b>LEFT JOIN</b> images <b>AS</b> i <b>ON</b> u.id = i.user_id;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>uid</th>
              <th>name</th>
              <th>iid</th>
              <th>url</th>
              <th>user_id</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
              <td>1</td>
              <td>image-1.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>1</td>
              <td>Mira</td>
              <td>2</td>
              <td>image-2.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
              <td>3</td>
              <td>image-3.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
              <td>4</td>
              <td>image-4.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Ivan</td>
              <td>5</td>
              <td>image-5.png</td>
              <td>3</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Metodi</td>
              <td>null</td>
              <td>null</td>
              <td>null</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Marina</td>
              <td>null</td>
              <td>null</td>
              <td>null</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Join with condition</h3>
      </div>
      <div class="info">
        <ul>
          <li>Display only users who commented on their own pics.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th colspan="2">users</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Sofia</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Ivan</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Metodi</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Marina</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">images</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>url</th>
              <th>user_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>image-1.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>image-2.png</td>
              <td>1</td>
            </tr>
            <tr>
              <td>3</td>
              <td>image-3.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>image-4.png</td>
              <td>2</td>
            </tr>
            <tr>
              <td>5</td>
              <td>image-5.png</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="4">comments</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>body</th>
              <th>user_id<sup>FK</sup></th>
              <th>image_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Pic of me</td>
              <td>1</td>
              <td>3</td>
            </tr>
            <tr>
              <td>2</td>
              <td>My best picture</td>
              <td>2</td>
              <td>5</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Nature picture</td>
              <td>3</td>
              <td>2</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> body, url, i.user_id <b>AS</b> img_user_id, c.user_id <b>AS</b> com_user_id, c.image_id <b>AS</b> com_img_id
<b>FROM</b> comments AS c <b>INNER JOIN</b> images <b>AS</b> i <b>ON</b> c.image_id = i.id
<b>WHERE</b> c.user_id = i.user_id;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>body</th>
              <th>url</th>
              <th>img_user_id</th>
              <th>com_user_id</th>
              <th>com_img_id</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pic of me</td>
              <td>image-3.png</td>
              <td>2</td>
              <td>2</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Join on generated table</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Except directly selecting a table we can also use generated by union
            two tables
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th colspan="2">users</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Eli</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Mira</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Iva</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">charities</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>amount</th>
              <th>user_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>150</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>235</td>
              <td>1</td>
            </tr>
            <tr>
              <td>3</td>
              <td>118</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>211</td>
              <td>3</td>
            </tr>
            <tr>
              <td>5</td>
              <td>98</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">spendings</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>amount</th>
              <th>user_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>250</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>118</td>
              <td>2</td>
            </tr>
            <tr>
              <td>3</td>
              <td>57</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>305</td>
              <td>2</td>
            </tr>
            <tr>
              <td>5</td>
              <td>24</td>
              <td>3</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name, activities.amount <b>FROM</b> users
<b>INNER JOIN</b> (
  <b>SELECT</b> user_id, amount <b>FROM</b> charities
  <b>UNION ALL</b>
  <b>SELECT</b> user_id, amount <b>FROM</b> spendings
) <b>AS</b> activities <b>ON</b> activities.user_id = users.id;
</pre>
      </div>
      <div>or alternative syntax using common table expression</div>
      <div class="query">
        <pre>
<b>WITH</b> activities <b>AS</b> (
  <b>SELECT</b> user_id, amount <b>FROM</b> charities
  <b>UNION ALL</b>
  <b>SELECT</b> user_id, amount <b>FROM</b> spendings
)
<b>SELECT</b> name, activities.amount <b>FROM</b> users
<b>INNER JOIN</b> activities <b>AS</b> activities <b>ON</b> activities.user_id = users.id;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Eli</td>
              <td>150</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>235</td>
            </tr>
            <tr>
              <td>Mira</td>
              <td>118</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>211</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>98</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>250</td>
            </tr>
            <tr>
              <td>Mira</td>
              <td>118</td>
            </tr>
            <tr>
              <td>Mira</td>
              <td>57</td>
            </tr>
            <tr>
              <td>Mira</td>
              <td>305</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>24</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Grouping data</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Group by is creating multiple subtables based on what we group by
            and executing aggregate functions on those subtables.
          </li>
          <li>
            After the select we can only have columns which appear after group
            by or aggreagte functions
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Mitko</td>
              <td>Sofia</td>
              <td>4000</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>3800</td>
            </tr>
            <tr>
              <td>Toni</td>
              <td>Plovdiv</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Polina</td>
              <td>Varna</td>
              <td>4500</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> city, <b>avg</b>(income) <b>AS</b> average_income <b>FROM</b> people
<b>GROUP BY</b> city;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>city</th>
              <th>average_income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Sofia</td>
              <td>4600.00000</td>
            </tr>
            <tr>
              <td>Varna</td>
              <td>4500.00000</td>
            </tr>
            <tr>
              <td>Plovdiv</td>
              <td>4400.00000</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Grouping data with having</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            WHERE will filter first some of the rows, then GROU BY will create
            subgroups and HAVING will filter the subgroups.
          </li>
          <li>
            Based on the above text, WHERE is filtering based on individual rows
            and HAVING on whole groups.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Angelina</td>
              <td>Sofia</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>Plovdiv</td>
              <td>4250</td>
            </tr>
            <tr>
              <td>Traqn</td>
              <td>Plovdiv</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>Varna</td>
              <td>4990</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> city, <b>avg</b>(income) <b>AS</b> average_income <b>FROM</b> people
<b>WHERE</b> income &lt;= 5000
<b>GROUP BY</b> city
<b>HAVING</b> <b>COUNT</b>(*) &gt; 1;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>city</th>
              <th>average_income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Plovdiv</td>
              <td>4575.00000</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sorting data</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            We will first sort by city ascending, then equal cities will be
            sorted by price descending and last by name.
          </li>
          <li>Ascending is by default so no need to specify it.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Angelina</td>
              <td>Sofia</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>Plovdiv</td>
              <td>4250</td>
            </tr>
            <tr>
              <td>Traqn</td>
              <td>Plovdiv</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>Varna</td>
              <td>4990</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>Sofia</td>
              <td>5100</td>
            </tr>
            <tr>
              <td>Mira</td>
              <td>Plovdiv</td>
              <td>4900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> * <b>FROM</b> people
<b>ORDER BY</b> city, income <b>DESC</b>, name;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Plovdiv</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Traqn</td>
              <td>Plovdiv</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>Plovdiv</td>
              <td>4250</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>Sofia</td>
              <td>5100</td>
            </tr>
            <tr>
              <td>Angelina</td>
              <td>Sofia</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>Varna</td>
              <td>4990</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Skip and limit results</h3>
      </div>
      <div class="info">
        <ul>
          <li>Useful for example for pagination.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Angelina</td>
              <td>Sofia</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>Plovdiv</td>
              <td>4250</td>
            </tr>
            <tr>
              <td>Traqn</td>
              <td>Plovdiv</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>Varna</td>
              <td>4990</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> * <b>FROM</b> people
<b>ORDER BY</b> income <b>LIMIT</b> 2 <b>OFFSET</b> 2;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Eli</td>
              <td>Varna</td>
              <td>4990</td>
            </tr>
            <tr>
              <td>Angelina</td>
              <td>Sofia</td>
              <td>5000</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Union reesults</h3>
      </div>
      <div class="info">
        <ul>
          <li>Useful for combining the result of different queries.</li>
          <li>Both queries must produce similar column structure.</li>
          <li>
            Without union all, just union we would get 3 results, because
            duplicates are ignored.
          </li>
          <li>
            if we use <b>INTERSECT</b> instead of <b>UNION</b> we would get only
            common results for both queries.
          </li>
          <li>
            if we use <b>EXCEPT</b> instead of <b>UNION</b> we would get the
            results from the first query except the results returned from the
            second query. Basically everything present in the first query except
            the second.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
              <th>taxes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Angelina</td>
              <td>5000</td>
              <td>350.50</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
              <td>220</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>4250</td>
              <td>160</td>
            </tr>
            <tr>
              <td>Traqn</td>
              <td>4900</td>
              <td>190</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>4990</td>
              <td>90</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
(<b>SELECT</b> * <b>FROM</b> people <b>ORDER BY</b> income <b>DESC LIMIT</b> 2)
<b>UNION ALL</b>
(<b>SELECT</b> * <b>FROM</b> people <b>ORDER BY</b> income - taxes <b>DESC LIMIT</b> 2);
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
              <th>taxes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
              <td>220</td>
            </tr>
            <tr>
              <td>Angelina</td>
              <td>5000</td>
              <td>350.50</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
              <td>220</td>
            </tr>
            <tr>
              <td>Eli</td>
              <td>4990</td>
              <td>90</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sub queries</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            With sub queries we can use the result of one query in another.
          </li>
          <li>
            Very <b>important</b> note here is to understand the returned type
            of the subquery. It is not table with one or many columns and rows.
            It is scalar type, single value which we can reuse. Basically,
            because the result is one column and one row.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Angelina</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>4250</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> * <b>FROM</b> people <b>WHERE</b> income &gt; (
  <b>SELECT</b> income <b>FROM</b> people <b>WHERE</b> name = 'Angelina'
);
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sub queries in the select clause.</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            For our custom column we will have value calculated with the scalar
            result returned by the subquery.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Angelina</td>
              <td>5000</td>
            </tr>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>4250</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name, income, income / (<b>SELECT</b> <b>max</b>(income) <b>FROM</b> people) <b>AS</b> ratio
<b>FROM</b> people <b>ORDER BY</b> income <b>DESC</b>;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>income</th>
              <th>ratio</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Valeria</td>
              <td>5200</td>
              <td>1.00000000000000000000</td>
            </tr>
            <tr>
              <td>Angelina</td>
              <td>5000</td>
              <td>0.96153846153846153846</td>
            </tr>
            <tr>
              <td>Evgeni</td>
              <td>4250</td>
              <td>0.81730769230769230769</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sub queries in the from clause.</h3>
      </div>
      <div class="info">
        <ul>
          <li>We are required to use alias AS c even if we don't use it.</li>
          <li>
            Outside the subquery, we can only use columns from the subquery.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>4500</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>5100</td>
            </tr>
            <tr>
              <td>Tina</td>
              <td>Plovdiv</td>
              <td>4750</td>
            </tr>
            <tr>
              <td>Ivan</td>
              <td>Sofia</td>
              <td>5500</td>
            </tr>
            <tr>
              <td>Deni</td>
              <td>Sofia</td>
              <td>4900</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> <b>avg</b>(c.cities_count)
<b>FROM</b> (
  <b>SELECT</b> city, <b>COUNT</b>(*) <b>AS</b> cities_count
  <b>FROM</b> people <b>GROUP BY</b> city
) <b>AS</b> c;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>avg</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2.5000000000000000</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sub queries with join.</h3>
      </div>
      <div class="info">
        <ul>
          <li>We will get users who purchased rice</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th colspan="2">users</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Iva</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Tanq</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Misho</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="2">products</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>product_name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Sugar</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Rice</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Milk</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">purchases</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>user_id<sup>FK</sup></th>
              <th>product_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>1</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>1</td>
              <td>3</td>
            </tr>
            <tr>
              <td>3</td>
              <td>2</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>3</td>
              <td>1</td>
            </tr>
            <tr>
              <td>5</td>
              <td>3</td>
              <td>2</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name <b>FROM</b> users
<b>INNER JOIN</b> (
  <b>SELECT</b> user_id <b>FROM</b> purchases <b>WHERE</b> product_id = 2
) <b>AS</b> p <b>ON</b> p.user_id = users.id;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Iva</td>
            </tr>
            <tr>
              <td>Tanq</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Sub queries in where clause.</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Inner select will return 1 column only so we can use it as array of
            values.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th colspan="2">users</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>name</th>
              <th>income</th>
              <th>taxes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Mira</td>
              <td>5200</td>
              <td>700</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Iva</td>
              <td>5100</td>
              <td>900</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Tanq</td>
              <td>5500</td>
              <td>1100</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Misho</td>
              <td>4900</td>
              <td>900</td>
            </tr>
          </tbody>
        </table>
        <table>
          <thead>
            <tr>
              <th colspan="3">purchases</th>
            </tr>
            <tr>
              <th>id<sup>PK</sup></th>
              <th>user_id<sup>FK</sup></th>
              <th>product_id<sup>FK</sup></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>1</td>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
              <td>1</td>
              <td>3</td>
            </tr>
            <tr>
              <td>3</td>
              <td>2</td>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
              <td>3</td>
              <td>1</td>
            </tr>
            <tr>
              <td>5</td>
              <td>3</td>
              <td>2</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> id <b>FROM</b> purchases <b>WHERE</b> user_id <b>IN</b> (
  <b>SELECT</b> id <b>FROM</b> users <b>WHERE</b> income - taxes &gt; 4300
);
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
            </tr>
            <tr>
              <td>2</td>
            </tr>
            <tr>
              <td>4</td>
            </tr>
            <tr>
              <td>5</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Another subquery example.</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            With ALL we will select onlyy users which have income higher than
            anyone from Plovdiv.
          </li>
          <li>
            With similar syntax with using SOME we can also achieve filtering
            behaviour.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>5100</td>
            </tr>
            <tr>
              <td>Tanq</td>
              <td>Sofia</td>
              <td>5500</td>
            </tr>
            <tr>
              <td>Misho</td>
              <td>Sofia</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Zaro</td>
              <td>Plovdiv</td>
              <td>5000</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> * <b>FROM</b> users <b>WHERE</b> income &gt; <b>ALL</b> (
  <b>SELECT</b> income <b>FROM</b> users <b>WHERE</b> city = 'Plovdiv'
);
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Tanq</td>
              <td>Sofia</td>
              <td>5500</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Select unique values</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            We will count all unique values, without count we would get once
            Sofia and once Plovdiv.
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
            </tr>
            <tr>
              <td>Tanq</td>
              <td>Sofia</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> <b>COUNT(DISTINCT</b> city) <b>FROM</b> users;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>count</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Switch case</h3>
      </div>
      <div class="info">
        <ul>
          <li>With Case we can get conditional value.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>city</th>
              <th>income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>Sofia</td>
              <td>5200</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>Plovdiv</td>
              <td>5100</td>
            </tr>
            <tr>
              <td>Tanq</td>
              <td>Sofia</td>
              <td>5500</td>
            </tr>
            <tr>
              <td>Misho</td>
              <td>Sofia</td>
              <td>4900</td>
            </tr>
            <tr>
              <td>Zaro</td>
              <td>Plovdiv</td>
              <td>5000</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>SELECT</b> name,
  <b>CASE</b>
    <b>WHEN</b> income &lt; 5000 <b>THEN</b> 'low'
    <b>WHEN</b> income &lt; 5500 <b>THEN</b> 'average'
    <b>ELSE</b> 'high'
  <b>END AS</b> formatted_income
<b>FROM</b> users;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>formatted_income</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Mira</td>
              <td>average</td>
            </tr>
            <tr>
              <td>Iva</td>
              <td>average</td>
            </tr>
            <tr>
              <td>Tanq</td>
              <td>high</td>
            </tr>
            <tr>
              <td>Misho</td>
              <td>low</td>
            </tr>
            <tr>
              <td>Zaro</td>
              <td>average</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Insights</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            With the following query we can get info of how our query was
            processed.
          </li>
          <li>For example we can see the execution time of our query.</li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>id</th>
              <th>name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Eli</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Mira</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Toni</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>EXPLAIN ANALYZE SELECT</b> * <b>FROM</b> users <b>WHERE</b> name = 'Eli';
</pre>
      </div>
    </section>

    <section>
      <div class="title">
        <h3>Transaction</h3>
      </div>
      <div class="info">
        <ul>
          <li>
            Transaction are usefull for operations requiring multiple queries
            depending on each other. If one of the queries for example fail we
            might want to cancel all the other queries.
          </li>
          <li>
            BEGIN will begin the transaction duplicating imaginary database on
            which we can run commands and the changes will be applied once we
            commit them.
          </li>
          <li>
            In pgAdmin if you open 2 query windows and running transaction on
            the first window, in the 2nd window you will see the changes applied
            once commited.
          </li>
          <li>
            Because the point of transactions is to remove the effect of the
            queries in case of error, we do that with the key word ROLLBACK. It
            will revert all the queries in the transaction(remove our imaginary
            database).
          </li>
        </ul>
      </div>
      <div class="source-table">
        <table>
          <thead>
            <tr>
              <th>id</th>
              <th>name</th>
              <th>amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Eli</td>
              <td>200</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Iva</td>
              <td>100</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="query">
        <pre>
<b>BEGIN</b>;
<b>UPDATE</b> people <b>SET</b> amount = amount - 50 <b>WHERE</b> name = 'Eli';
<b>UPDATE</b> people <b>SET</b> amount = amount + 50 <b>WHERE</b> name = 'Iva';
<b>COMMIT</b>;
</pre>
      </div>
      <div class="result-table">
        <table>
          <thead>
            <tr>
              <th>id</th>
              <th>name</th>
              <th>amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Eli</td>
              <td>150</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Iva</td>
              <td>150</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </body>
</html>
